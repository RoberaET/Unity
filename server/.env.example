# ============================================
# UNITY FINANCE BACKEND - ENVIRONMENT VARIABLES
# ============================================
# Copy this file to .env and fill in your actual values
# NEVER commit .env to version control!

# ============================================
# DATABASE
# ============================================
# PostgreSQL connection string
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE
# Example: postgresql://postgres:password@localhost:5432/unity_finance
DATABASE_URL=postgresql://postgres:password@localhost:5432/unity_finance

# ============================================
# REDIS (Required for Production)
# ============================================
# Redis connection string for session storage, rate limiting, caching
# Format: redis://HOST:PORT or redis://:PASSWORD@HOST:PORT
# Local: redis://localhost:6379
# Cloud: redis://:your-password@redis-cloud-url:6379
REDIS_URL=redis://localhost:6379

# ============================================
# JWT AUTHENTICATION
# ============================================
# Secret key for signing JWT access tokens
# CRITICAL: Change this to a random string in production!
# Generate: openssl rand -base64 64
JWT_SECRET=your-super-secret-jwt-key-change-in-production

# Access token expiration (short-lived for security)
# Examples: 15m, 1h, 30m
JWT_EXPIRES_IN=15m

# Secret key for refresh tokens (should be different from JWT_SECRET)
# Generate: openssl rand -base64 64
REFRESH_TOKEN_SECRET=your-super-secret-refresh-token-key-change-in-production

# Refresh token expiration (long-lived for convenience)
# Examples: 7d, 30d, 90d
REFRESH_TOKEN_EXPIRES_IN=7d

# ============================================
# ACCOUNT SECURITY
# ============================================
# Number of failed login attempts before account lockout
MAX_LOGIN_ATTEMPTS=5

# Duration of account lockout in minutes
LOCKOUT_DURATION_MINUTES=30

# ============================================
# RATE LIMITING
# ============================================
# General API rate limiting (per IP)
RATE_LIMIT_WINDOW_MS=900000        # 15 minutes in milliseconds
RATE_LIMIT_MAX_REQUESTS=100        # Max requests per window

# Signup throttling (per IP, prevents abuse)
SIGNUP_LIMIT_WINDOW_MS=86400000    # 24 hours in milliseconds
SIGNUP_LIMIT_MAX_REQUESTS=5        # Max signups per day per IP

# Login rate limiting (per IP, additional to user-based lockout)
LOGIN_LIMIT_WINDOW_MS=3600000      # 1 hour in milliseconds
LOGIN_LIMIT_MAX_REQUESTS=10        # Max login attempts per hour per IP

# ============================================
# FEATURE FLAGS (Default Values)
# ============================================
# These override database values (emergency killswitch)
# Set to 'false' to instantly disable a feature without code deployment
# Leave commented to use database values

# FEATURE_DATA_EXPORT=true
# FEATURE_PDF_EXPORT=true

# ============================================
# OBSERVABILITY (Sentry Error Tracking)
# ============================================
# Sentry DSN for error tracking
# Get this from https://sentry.io after creating a project
# Leave empty to disable Sentry (not recommended for production)
SENTRY_DSN=https://your-key@o1234567.ingest.sentry.io/1234567

# Environment name for Sentry (helps filter errors)
# Examples: development, staging, production
SENTRY_ENVIRONMENT=development

# Sample rate for performance monitoring (0.0 to 1.0)
# 0.1 = 10% of requests are traced (reduces overhead)
SENTRY_TRACES_SAMPLE_RATE=0.1

# Git commit SHA for release tracking (optional, set by CI/CD)
# GIT_COMMIT_SHA=abc123def456

# ============================================
# PERFORMANCE MONITORING
# ============================================
# Threshold for slow query logging (milliseconds)
# Queries slower than this will be logged as warnings
SLOW_QUERY_THRESHOLD_MS=1000

# Threshold for slow request logging (milliseconds)
# HTTP requests slower than this will be logged
SLOW_REQUEST_THRESHOLD_MS=3000

# ============================================
# CACHING
# ============================================
# Default cache max-age for cacheable APIs (seconds)
# 300 = 5 minutes
CACHE_MAX_AGE=300

# ============================================
# SERVER CONFIGURATION
# ============================================
# Port for the server to listen on
PORT=3001

# Node environment
# Options: development, production, test
NODE_ENV=development

# Frontend URL for CORS
# Allow requests from your frontend application
# Examples: http://localhost:5173, https://app.yourfinanceapp.com
FRONTEND_URL=http://localhost:5173

# ============================================
# PRODUCTION DEPLOYMENT NOTES
# ============================================
# 1. All *_SECRET variables MUST be changed to random values
# 2. REDIS_URL must point to a production Redis instance
# 3. DATABASE_URL must point to a production PostgreSQL instance
# 4. SENTRY_DSN should be configured for error tracking
# 5. NODE_ENV should be set to 'production'
# 6. FRONTEND_URL should be your production domain
# 7. Use environment variables in your hosting platform (Vercel, Heroku, AWS, etc.)
# 8. NEVER commit .env file to version control

# ============================================
# OPTIONAL: DATABASE CONNECTION POOL
# ============================================
# PostgreSQL connection pool settings (advanced)
# Only needed if you experience connection issues under high load
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?connection_limit=10
# Example: DATABASE_URL=postgresql://user:pass@host:5432/db?connection_limit=10

# ============================================
# SECURITY CHECKLIST FOR PRODUCTION
# ============================================
# [ ] Changed all *_SECRET variables to random values
# [ ] Configured production database with backups
# [ ] Configured production Redis with persistence
# [ ] Set up SENTRY_DSN for error tracking
# [ ] Enabled HTTPS for all connections
# [ ] Reviewed CORS settings (FRONTEND_URL)
# [ ] Configured rate limiting for your traffic
# [ ] Set up database backups and point-in-time recovery
# [ ] Tested account lockout functionality
# [ ] Verified soft delete works for all models
# [ ] Tested data export (CSV/PDF)
# [ ] Verified feature flags can be toggled
# [ ] Set up monitoring/alerting for server and database
